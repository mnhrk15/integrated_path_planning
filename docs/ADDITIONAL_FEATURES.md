# 追加統合機能ガイド

このドキュメントでは、プロジェクトに追加された3つの主要機能について詳しく説明します。

## 目次

1. [Social-GAN学習済みモデル統合](#1-social-gan学習済みモデル統合)
2. [PySocialForce統合](#2-pysocialforce統合)  
3. [高度なアニメーション可視化](#3-高度なアニメーション可視化)
4. [静的障害物と安全パラメータ](#4-静的障害物と安全パラメータ)
5. [プランナコスト重みの上書き](#5-プランナコスト重みの上書き)
6. [時間整合した予測・衝突判定](#6-時間整合した予測衝突判定)

---

## 概要

PySocialForce/可視化など多くの機能はオプションですが、軌道予測には学習済みSocial-GANモデルが必須です（フォールバックなし）。

詳細は完全版ドキュメントを参照してください。

## 4. 静的障害物と安全パラメータ

- シナリオYAMLで`static_obstacles`（矩形: `[x_min, x_max, y_min, y_max]`）を指定すると、プランナの衝突判定に組み込まれます。
- 安全パラメータ（デフォルトは`default_config.yaml`参照）:
  - `ego_radius`, `ped_radius`, `obstacle_radius`, `safety_buffer`
- これらは膨張半径として衝突判定・安全メトリクス（`min_distance`, `ttc`）に利用されます。

## 5. プランナコスト重みの上書き

- Frenetプランナのコスト重みを設定で上書き可能です。
  - `k_j`, `k_t`, `k_d`, `k_s_dot`, `k_lat`, `k_lon`
- 未指定の場合は従来の定数が使われます。シナリオごとに調整してチューニングが可能です。

## 6. 時間整合した予測・衝突判定

- 観測: シミュレーション `dt` に依らず、SGAN 想定の 0.4s 間隔にダウンサンプリングして蓄積します。
- 予測: SGAN 出力（0.4s 間隔）をシミュレーション `dt`（例: 0.1s）に補間し、計画ホライゾン 5s まで等速外挿します。
- 衝突判定: 動的障害物は時間軸を維持したまま評価し、パス時刻 `t` に対応する位置との距離のみを判定します（未来軌道の平坦化なし）。過剰なブレーキや回避を防ぎ、時間整合した安全判定を行います。
